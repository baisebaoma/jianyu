# 简浴包编写心得

[toc]

## 前言

本人从 2023 年 11 月 31 日开始接触新月杀扩展包开发，迄今（本文开始写作时大约是 12 月 24 日）已有 20 天余，实现了武将若干，已经有一些经验了。这个文档是为了方便您想参考本扩展包来制作自己的扩展包的~~虽然我知道你不想看文档~~。我会尽可能使用通俗易懂的话，每个武将会讲一些内容。

如果您有想制作的技能，新月杀中几乎一定有一个类似的技能（或一部分）。但是直接去阅读那个技能的代码会非常难以理解。推荐您的学习路线为：如果您对 Lua 没有任何基础，建议先学习一些编程知识。然后，查阅新月杀的 Docs 文件夹，那里有不错的介绍。最后，请你打开 `/packages/standard`，阅读并理解标准包的代码。现在你已经有基础知识了，理解其他人的代码并运用到自己的设计中~~并且没有 bug~~ 就会非常简单了。

祝您编程愉快！

一些关于强度的讨论：因为本包基本就活在活动服里，活动服的强度已经崩坏，所以其实多强都不过分。不过我是一般是会控制在风林火山的强度（毕竟我和朋友们玩基本只开这些强度的包）。

## 查阅资料

我推荐使用 GitHub 浏览 FreeKill 仓库（方便搜索你需要的函数原型），并使用 Everything 软件搜索自己客户端安装的所有扩展包的代码。Gitee 对于代码搜索好像并没有什么支持，而 GitHub 支持得挺好。也许还有更好的办法？不过我目前暂时就是这样用的。

## 命名规范

这里是一些我自己的个人习惯，我觉得有好处。将你自己的技能都加一个前缀（如简浴包所有的技能名都有`jy_`前缀）。这是为了防止重名。在我制作武将李元浩的技能【虎啸】时，其他扩展包已经有一个叫作`huxiao`的技能了，所以报错。我决定在我自己的扩展包中全部加前缀，尽量避免和其他扩展包重名。

## 武将概要

我们以这段代码为例吧！以下是一个武将的所有部分。

```Lua
-- 第二代简自豪
local tym__jianzihao = General(extension, "tym__jianzihao", "qun", 3)

local jy_sanjian = fk.CreateTriggerSkill{
  -- 技能略
}

local jy_xizao_2 = fk.CreateTriggerSkill{
  -- 技能略
}

tym__jianzihao:addSkill(jy_kaiju_2)
tym__jianzihao:addSkill(jy_sanjian)
tym__jianzihao:addSkill("hongyan")  -- 这个技能要加风火林山包才能使用！
tym__jianzihao:addSkill("jy_zouwei")
tym__jianzihao:addSkill("jy_shengnu")
tym__jianzihao:addSkill(jy_xizao_2)

Fk:loadTranslationTable{
  ["tym__jianzihao"] = "界简自豪",

  ["jy_kaiju_2"] = "开局",
  [":jy_kaiju_2"] = "出牌阶段限一次，你选择若干名角色，依次视为你对其使用一张【顺手牵羊】，然后被其使用一张【杀】。",
  ["$jy_kaiju_21"] = "不是啊，我炸一对鬼的时候我在打什么，打一对10。一对10，他四个9炸我，我不输了吗？",
  ["$jy_kaiju_22"] = "怎么赢啊？你别瞎说啊！",
  ["$jy_kaiju_23"] = "打这牌怎么打？兄弟们快教我，我看着头晕！",
  ["$jy_kaiju_24"] = "好亏呀，我每一波都。",
  ["$jy_kaiju_25"] = "被秀了，操。",
  ["$jy_kaiju_26"] = "从未如此美妙的开局！请为我欢呼，为我喝，喝，喝彩，OK？",
  ["$jy_kaiju_27"] = "如此美妙的开局，这是我近两天来第一次啊！",
  ["$jy_kaiju_28"] = "Oh my God，我要珍惜这段时光，我要好好地将它珍惜！",

  ["jy_sanjian"] = "三件",
  [":jy_sanjian"] = [[锁定技，出牌阶段开始时，若装备区有且仅有3张牌，你视为使用一张【酒】和一张【无中生有】。]],
  ["$jy_sanjian1"] = "也不是稳赢吧，我觉得赢了！",

  ["jy_xizao_2"] = "洗澡",
  [":jy_xizao_2"] = "限定技，处于濒死状态且装备区有牌时，你可以弃置所有装备区的牌、将体力恢复至1，然后每以此法弃置一张牌，你摸一张牌。",
  ["$jy_xizao_21"] = "呃啊啊啊啊啊啊啊！！",
  ["$jy_xizao_22"] = "也不是稳赢吧，我觉得赢了！",
  ["$jy_xizao_23"] = "真的我是真玩不了，这跟变态没关系，我好他妈的气！",

  ["~tym__jianzihao"] = "好像又要倒下了……",
}
```

在这段代码中，首先你需要定义一个 General（武将）类；然后，你需要编写这个武将对应的技能以及添加这些技能到这个武将；最后，你需要为这个武将添加翻译表。

### 编写技能

这部分挺复杂的，在 FreeKill 官方文档里有说明，请你先去阅读那里。

我需要强调的一点是：所有部分都是可以省略的。在官方文档以及代码中，新手可能会看不懂，【遗计】监听 `fk.Damaged` （伤害造成后）事件，但为什么代码看起来这个事件就可以直接触发摸牌？难道所有人受到伤害都可以触发【遗计】吗？这是因为郭嘉的【遗计】在官方代码中没有 `can_trigger`、`on_trigger` 写两个参数。传入默认参数就可以了。默认参数就已经包含了判断下列条件：确实是我受到的伤害、我拥有这个技能。`on_cost` 中写了每受到一点伤害就要发动一次，而 `on_use` 中写了他需要摸两张牌并且分配之。

其实理解了这里，基本就能看懂很多技能了。

### 添加技能

#### 直接技能

添加技能如你所见，使用 `General:addSkill()` 就可以了。特别注意：对于一个技能，第一个添加它的武将需要用它的变量名来添加，而其他武将添加它需要使用它的名字的字符串来添加，如你上文所见。我想设计一个“原神技”，名字叫 `jy_yuanshen`，也就是说所有基于原神角色制作的武将都会有完全相同的这个技能。这种情况下，我需要先让第一个武将使用变量名来获得这个技能，然后其他武将使用它的名字来获得这个技能。

这两种添加技能的多态方法混用时，似乎不能指定技能的显示顺序。不过我觉得没什么所谓。如果你实在介意这个，你可以复制粘贴一遍那个技能，改个名字就行了。

#### 相关技能

有的时候也会使用 `General:addRelatedSkill()`，这个方法的目的是在武将一览页面中在末尾以紫色提示这个武将可能会拥有这个技能，而且这个技能属于其他武将。

请注意，你得保证你拥有这个包的服务器上拥有这些对应技能，不然会报错，因为找不到这个技能在哪。

```Lua
tym__kgdxs:addSkill(jy_zuoti)
tym__kgdxs:addSkill(jy_jieju)
tym__kgdxs:addRelatedSkill("jizhi")
tym__kgdxs:addRelatedSkill("kanpo")
tym__kgdxs:addRelatedSkill("xiangle")
tym__kgdxs:addRelatedSkill("jy_yuyu")
tym__kgdxs:addRelatedSkill("jy_hongwen")
```

以这段考公大学生的代码为例，考公大学生的使命技有可能会使他获得【集智】、【看破】、【享乐】、【玉玉】、【红温】，那么建议你把这些技能使用 `General:addRelatedSkill()` 添加给这个武将，来方便玩家如果不知道这些技能的效果，那么可以在这个武将的这里知道这个效果如何。

## 阿威罗：将别人设计的武将转化为需求

我觉得正确的制作武将的流程是：对标强度、设计武将、细化需求、翻译成详尽的中文、根据每一段中文来实现这个功能、测试强度和问题。怎么感觉有点像软件工程了，不过制作武将的流程还真是软件工程。我们以这个武将为例吧。

先得确定你这个武将到底要对标哪个包、哪个将的强度。如果你要对标的是谋关羽或者活动服的牛鬼蛇神，那怎么强都不过分；如果你要对标的是风林火山，那就要控制好强度，不能让这些将完全没法打你。

这个武将是我的朋友“导演片子怎么样了”设计的，我看着好像有点意思就实现了。但是问题是：他的描述非常不规范。我们看一下他原来的描述：

> 阿伟罗
> 游龙：回合开始阶段，你可以让每位玩家顺时针递交一张手牌给其下家
> 核爆：回合开始阶段，你可以将一张手牌扣于你的武将牌上，视为“点”，当“点”花色不同时，你视为使用一张**入侵，回合内仅限一次
> 跳水：当你失去体力时，你可以移出一张“点”
> 罗绞：当你的“点”有四张时，视为使用一张万箭齐发
> 玉玊：你同一回合内的第一张基本牌视为玉，第二张基本牌视为玊，当你使用玊时，将同时视为打出一张同花色“点”

你可能也会遇到这种情况，即你的朋友设计的武将，你要实现，但是他写的你不一定看得懂，或者他写的不够详细。你得推测他的意图（当然，最好直接问他，省得你做好了他跟你说不对又要你改~~如果他完全不懂游戏规则，那还是别做他的武将了，防止吵架~~）。

你不说体力，那我们看一眼强度。这么多 AOE，掉血还放 AOE，那我默认 3 体力了，不然别人没法玩。

然后，‘当你失去体力时’，“失去体力”和“受到伤害”是两个完全不同的事件，他自己又没有主动失去体力的技能，那就基本触发不了了。这个肯定不对。我的建议是改成受到伤害，这样触发频率高得多，对标强度也说得过去。

其次，“当‘点’花色不同时”，那一张“点”的时候算花色相同还是花色不同？我是当作相同的做的，因为只有一张牌的话，和自己的花色肯定相同啊。他后来说一张“点”算不同的，那按他说的为准吧。所以一定要描述详细一点！

再次，“打出一张同花色‘点’”是什么意思？‘点’不是被移出游戏置于武将牌上的吗？通过理解，我们觉得他的意思应该是把这张你使用的牌作为“点”放在武将牌上。

我们翻译完，其实发现他想做的事情就是让“点”的数量变动时，检测花色和数量，如果花色不同就放**入侵（每回合限一次，他自己说的），如果数量为4就放万箭齐发。然后你受到伤害时可以弃一张“点”，你准备阶段可以用一张手牌当“点”，你使用的第二张基本牌可以当“点”。这就是需求了。

把它翻译成三国杀的中文吧！有两个相似的需求，那就是检测花色和数量，并执行不同的效果，我建议把这两个需求合成一个技能。其他的变成规范的技能描述即可。

我们生产了下面这个版本：

> 阿威罗 群 体力3
>
> 游龙：锁定技，准备阶段，有手牌的角色依次将一张手牌交给下家。
>
> 核爆：准备阶段，可以将一张手牌置于武将牌上，称为【点】。
>
> 跳水：受到伤害时，可以弃置一张【点】。
>
> 玉玊：出牌阶段，你每使用第二张基本牌时，可以将其作为【点】置于你的武将牌上。
>
> 罗绞：当【点】的数量变化后：
>
> 1. 若你没有两张及以上相同花色的【点】，可以视为立即使用一张【**入侵】，每回合限一次；<br>
> 1. 若你有4张【点】，可以视为立即使用一张【万箭齐发】。

看起来规范多了！请注意，【游龙】我改为了锁定技，因为这个武将有两个准备阶段的技能，每次都让选择谁先发动会有点不太用户友好；稍微加强了一点【玉玊】，因为对于这个武将来说，“点”太多不是好事，而且反正【罗绞】的**入侵每回合只能使用一次，让他自己多选择一次吧。

尽管我改成这样，但他还是说不对。他希望【玉玊】之后也能触发**入侵，我说“你写的就是“回合内仅限一次”啊。再说了，那就会有点太恶心了。

类似的还有这个扩展包里的高天亮。他之前说的是：受到来自队友的伤害时，摸三张牌然后翻面。那如何定义队友？他跟我说，所有人都是你的队友，对你使用了杀造成了伤害的就不是你的队友。所以我最后写成了下面这个版本，效果是一样的。

> 玉玉：
>
> 1. 锁定技，当有角色对你使用【杀】造成了伤害时，其获得【致郁】标记；<br>
> 2. 受到没有【致郁】标记的角色或因本次伤害而获得【致郁】标记的角色造成的伤害时，你可以选择一项：摸三张牌；摸四张牌并翻面。

这个工作看起来也太像阅读理解了吧。我觉得这种工作需要又精通三国杀，又精通代码，知道哪些需求能写出来、哪些需求写不出来。但总之，我们已经顺利把它转换成程序员喜欢的文字了！

## 考公大学生：参考别人的代码与爬虫

这是我认为简浴包最天才的武将之一。这个武将很好地使用测试包的谋徐盛（有很多用于测试的技能）中的“cheat”技能，结合做选择题（并且也实现了让全场玩家都可以看到正在做的题的题干和答案），使用爬虫技术结合人工处理数据，设计出了一个有强度、平衡、有实用价值（应该说最有实用价值的吧，毕竟哪个其他武将能帮你考公？）、娱乐（随机性大但题目难度稳定、题库大）、玩家反馈合理（正反馈强、答错无惩罚）的武将。经过群友的强度测试，总体感觉是符合简浴包合理强度的，不至于让别的武将没法玩，使命成功（但是很难）之后也能获得极强的正反馈。

> 做题：出牌阶段限一次，你可以做一道行测真题。若正确，你可以获得一张想要的牌。<br>
>
>   <font size="1">本武将推荐操作时长：60秒<br>
>
>   当前收录试卷：..total_papers..套，题目总量：..total_questions..（含相同题目），全部经人工筛选，不含图形推理、资料分析，全部取自2018-2023国家公务员录用考试《行测》真题。<br>
>
>   你选择的这张牌可能来自于任何位置，包括其他角色的区域、你自己的手牌。所以建议先把同牌名的牌使用掉。</font>
>
> 熬夜：使命技，出牌阶段限一次，你可以失去一点体力使【做题】可以再使用一次。<br>
>
>   成功：回合结束时，若你【做题】答对比答错至少多3，你摸3张牌，然后获得技能【集智】、【看破】、【享乐】；<br>
>
>   失败：回合结束时，若你【做题】答错比答对至少多3，你翻面、减一点体力上限，然后获得技能【玉玉】、【红温】。

我们挑些重点说。设计武将没那么难~~如果不要求平衡的话~~，但是将设计的武将的一两百字中文翻译成代码，是需要拆分需求的。一个技能可能有多个部分，每个部分都要各司其职。

#### 参考别人的代码

这是我已经较为熟练之后设计并制作的武将，所以你可能会看到一些我的注释。如，定义完武将后，看到了下面的注释：

```Lua
-- 获得一张牌：谋徐盛cheat
-- 还可以继续发动：甄姬洛神
-- 出牌阶段主动：界简自豪开局
-- 选择：界李元浩二段
-- 使命技：不知道，到时候再说
```

这段注释代表着“为了实现我的设计，我需要参考哪些技能”。如果你不知道你的技能可以参考谁，建议问群友或者百度。群友一般都会给你令你满意的答复（除了有些黑话我不知道，如群友说李谢，我半天不知道谁是李谢，原来是两个人。）

去看对应的代码就可以了，删掉不需要的部分，然后应用到自己的代码里。

#### 爬虫

说实话我对爬虫一窍不通，上次爬东西可能是三四年前了（爬 op.gg 的英雄数据并且获得合适的出装，当时还天天沉迷英雄联盟，服了）。我直接让 ChatGPT 帮我搞的。给它看一部分你的 html 文件，告诉它你要什么样的输出（在我这里，我需要 Lua 的 table 形式）让它生成代码来帮你爬，哪里不对告诉它，它会改。最终跟它一起琢磨了两个多小时，就搞好了，我基本上自己没怎么写代码。你可以去 `packages/jianyu/questions/pachong.py` 看到这段代码，并在相同文件夹下看到所有爬到的试卷。我已经抽样调查过了，就算题目可能有一点格式问题，但答案确实是正确的。

当然还是有些问题的，比如题目里面的下划线用的是\<u\>标签，我爬不到；百分号和英文冒号会被认成通配符导致不显示后面的字了；图片题做不了，需要删除；过时时政题和材料题建议删掉。这些手动解决一下吧，反正一张卷子也就几分钟就搞好了，不碍事。让 ChatGPT 搞半天他也搞不好。

我觉得都 2023 年了，是时候学会让 AI 来帮助你完成任务了。一些小技巧就是你得描述得足够仔细，它才能输出你想要的东西，不然它可能理解不到。

## 雷电将军：平衡武将

这个原神角色改编成三国杀武将看起来没什么难度，核心机制就是给队友挂雷眼，队友造成伤害的时候我也造成一次伤害，然后可以在合适的时候开大砍别人一刀。

一开始我的设计是每回合给一名角色挂雷眼，有雷眼的角色造成伤害时判定，若为♣就造成1点雷伤并获得一个愿力。然后每回合可以消耗所有愿力砍一次，有多少愿力就造成多少伤害+1。后来经过PVE测试发现节奏太慢了，看起来很厉害，但实际上没什么用（尤其是在活动服环境里）。调整了很多天，中间也研究过弃牌砍一刀什么的，但感觉对一个无法额外摸牌的武将来说有点垃圾。最后改成了红色给愿力黑色1点雷伤，砍一刀只造成1点伤害，但给所有有雷眼的人有多少愿力发多少张牌。

这样就几乎成了一个纯粹的辅助，给队友增伤发牌，无条件制伤，牌好的情况下自己也有一定输出能力（指一回合打三四点）。我承认确实可能有点强了，但强度这个东西，不得已而为之。大家都强，作为简浴包的第一个神将，当然强度要给高一点。总的来说我觉得设计还是比较成功的，但我觉得可能要把四血改成三血，不然不开其他DIY将的场上出现一个这个东西太超模了，伤害过高。之后再观察一段时间吧。

## 神里绫人：改编武将

大概描述一下这个角色在《原神》里的技能，普攻没什么用，小技能是位移一小段，然后加强普通攻击变成大范围水伤，大招是让自己周围区域随机落水花造成伤害，被动一是给小技能按生命值增伤，被动二是自己处于后台且蓝低于一半时回大招的蓝。命座一是对生命值低于一半的目标伤害提升，命座二是增加小技能生命值倍率、开小技能获得生命值，后面的就不用介绍了。如果读者读到这里，您可以想一下如果您来改编这个角色到《三国杀》里，您会如何设计他的技能。

其实不太好设计。毕竟《三国杀》武将绝大多数只有个位数的血，每次增伤都很致命；大招如果做成随机伤害，又不可控，打谁？怎么选目标？怎么造成伤害？持续多久？我想了好久也没想明白，也许可以设计成定时炸弹那样，但我觉得随机打击角色不是很好设计，玩法也不好。

我的设计一般都是技能描述越简洁越好，能让玩家一下就看得懂，不然阅读个几百字挺痛苦的。如果我只写一段话，但这段话可以包含很多功能，这是最好的。最后我决定放弃大招，从小技能、被动二和命座二着手，设计了现在这个版本。基本回合外使用基本牌就能摸，然后如果用了杀还能额外摸一张。如果能一直保持杀闪的节奏，能多摸很多牌，但是要是残血了就寄。回合内也能额外出一张杀、加手牌上限，回合外能多造成伤害，要是快被人杀了还能一定程度上避免其摸牌（因为闪杀后加两点血，回合结束自己失去2点体力，就紫砂了）。

强度是故意设计的不高的，因为我和朋友玩的时候基本上都没开强度特别变态的武将，我也不希望简浴包的武将强度膨胀得太快。我觉得杨藩（杨藩没什么好说的，就不单开一节了）这个武将的强度就已经有点高了，4血，掉血大概率摸2张，觉醒之后加体力上限还巨强，这让开服5个技能的简自豪有点难绷，感觉就算是界简自豪也没杨藩强。不过这些都是群友设计的，强度不归我管，他要是设计个被闪电劈中直接胜利的武将，那我也得给他做。

对了，如果你需要提取官方的原神角色配音，我在代码的这部分里写了一段注释，你可以去看看。

## 高天亮：平衡武将

说实话我的版本理解完全停留在标准包1血=2牌的基础上，所以当群友告诉我受一次伤摸三张牌并翻面，我甚至觉得挺合理的，因为反正可以翻回来（这个版本后来诞生了神曹操高天亮的搭配，摸全场一张然后翻面，然后又玉玉翻回来摸三张，太恶心人了）

后来发现没什么用，纯摸牌白板，后期单挑也是白板，所以决定加强技能。既然技能特色是摸牌，那就贯彻到底咯？狠狠地摸！

其实我觉得摸牌很多不是很恐怖，反正摸牌白板也用不出去，而且高天亮的设计是被杀了就不能继续从这个人的伤害里摸了。

鼓励玩家翻面（确实抑郁了），所以我最后加到了选择摸3张牌或者选择摸6张牌并翻面。

就先写到这里，别的明年再说吧。

